% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/smooth.construct.A2Matern.smooth.spec.R
\name{smooth.construct.A2Matern.smooth.spec}
\alias{smooth.construct.A2Matern.smooth.spec}
\title{Construct a Bivariate Matern-based Smooth Term with Fixed and Random Effects}
\usage{
\method{smooth.construct}{A2Matern.smooth.spec}(object, data, knots)
}
\arguments{
\item{object}{A smooth specification object created by `s()`, containing user-defined smoothing parameters.}

\item{data}{A data frame containing the two covariates (`x1`, `x2`) for the bivariate smooth term.}

\item{knots}{A list of knots supplied by the user or automatically generated from `x1` and `x2`.}
}
\value{
A smooth term object of class `"A2Matern.smooth"`, `"mgcv.smooth"`, containing:
\itemize{
  \item `X`: The final design matrix combining fixed and random effect components.
  \item `S`: The smoothing penalty matrix.
  \item `rank`: The effective rank of the penalty matrix.
  \item `null.space.dim`: The dimension of the fixed effect (null space).
  \item `null.project`: Projection matrix onto the null space.
  \item `smoothfun`: The function used to generate the Matern basis.
  \item `kappa_matern`: The selected k-means centroids used as knots for Matern splines.
  \item `lambda_matern`: The scale parameter for the Matern spline.
}
}
\description{
This function constructs a smooth term for bivariate data (x1, x2) using Matern splines, incorporating
both fixed and random effects to model parameter effects. The fixed effects structure is user-defined
via `getA`, stored in `xt$getA`, with corresponding parameters provided in `xt$para` as lists.
These functions must take only `x` (data) and `para` (parameters) as inputs, allowing customization of the fixed effect structure.

The smooth term dimension (`k`) combines the fixed effect (null space) dimension and the random effect
dimension. The `m` parameter specifies two values: the number of knots (`nk`) for generating the Matern
spline (based on k-means clustering of `x1` and `x2`), and the scale parameter (`lambda`) for the Matern
spline construction. The Matern spline is subjected to PCA, retaining the top principal components such
that the number of retained PCs equals `k - fixed effect dimension`.

The function returns a smooth term object with the design matrix, penalty matrix, and metadata such as
selected Matern knots and scale parameters, suitable for modeling bivariate parameter effects in a GAM.
}
\examples{
\dontrun{
library(mgcv)
set.seed(42)
dat <- data.frame(x1 = runif(100), x2 = runif(100), y = rnorm(100))
fit <- gam(y~s(x1, x2, bs = "A2Matern", k = 12,
               xt=list(getA=function(x1,x2,para){cbind(1,x1,x2,x1*x2},
               para=NULL)
           data = dat, method = "REML")
summary(fit)
}

}
